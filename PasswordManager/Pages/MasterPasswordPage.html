<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Password Manager</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <meta charset="UTF-8">
        <meta name="description" content="Password Manager - Manage or Generate your Passwords with Ease">
        <meta name="keywords" content="password, generator, secure">
        <meta name="author" content="Abhinav Satheesh">
        <link rel="stylesheet" href="../styles.css">
        <link rel="icon" href="../Assets/icon_512.png">
        <link rel="apple-touch-icon" href="Assets/icon-72x72.png" />
        <link rel="apple-touch-icon" href="Assets/icon-96x96.png" />
        <link rel="apple-touch-icon" href="Assets/icon-128x128.png" />
        <link rel="apple-touch-icon" href="Assets/icon-144x144.png" />
        <link rel="apple-touch-icon" href="Assets/icon-152x152.png" />
        <link rel="apple-touch-icon" href="Assets/icon-192x192.png" />
        <link rel="apple-touch-icon" href="Assets/icon-384x384.png" />
        <link rel="apple-touch-icon" href="Assets/icon-512x512.png" />
        <meta name="apple-mobile-web-app-status-bar" content="#f69435" />
        <meta name="theme-color" content="#f69435" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    </head>
    <body onload="populateSettings()">
        <center>
            <h1>Master Password Settings</h1>
            <br><br>
            <label for="CurrentPassword">Current Master Password:</label>
            <Input type="password" id="CurrentPassword" name="CurrentPassword" placeholder="Current Master Password" required>
            <br><br>
            <button onclick="changePassword()" class="button">Set / Change Master Password</button>
            <br><br>
            <button onclick="window.history.back()" class="button">&lt; Go Back</button>
        </center>
    </body>
    <script src="../secure.js" crossorigin="anonymous"></script>
    <script>
        function populateSettings()
        {
            var masterPassword = localStorage.getItem("masterPassword");
            document.getElementById("CurrentPassword").value = masterPassword;
            if(masterPassword == null)
            {
                changePassword()
                window.location.href = "../index.html"
            }
            else if (masterPassword == "null")
            {
                changePassword()
                window.location.href = "../index.html"
            }
            else if (masterPassword == "")
            {
                changePassword()
                window.location.href = "../index.html"
            }
        }
        function changePassword()
        {
            if (localStorage.getItem("masterPassword") == null)
            {
                var newPassword = prompt("Enter the New Master Password");
                localStorage.setItem("masterPassword", newPassword);
                alert("Master Password Changed Successfully");
                window.location.reload();
            }
            else if (localStorage.getItem("masterPassword") == "null")
            {
                var newPassword = prompt("Enter the New Master Password");
                localStorage.setItem("masterPassword", newPassword);
                alert("Master Password Changed Successfully");
                window.location.reload();
            }
            else if (localStorage.getItem("masterPassword") == "")
            {
                var newPassword = prompt("Enter the New Master Password");
                localStorage.setItem("masterPassword", newPassword);
                alert("Master Password Changed Successfully");
                window.location.reload();
            }
            else
            {
                var current = prompt("Enter the Current Master Password")
                if (current == localStorage.getItem("masterPassword"))
                {
                    var newPassword = prompt("Enter the New Master Password");
                    localStorage.setItem("masterPassword", newPassword);
                    alert("Master Password Changed Successfully");
                    window.location.reload();
                }
                else
                {
                    alert("Incorrect Master Password");
                }
            }
        }
    </script>
</html>